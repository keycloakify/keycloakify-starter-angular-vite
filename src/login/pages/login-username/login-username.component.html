@let realm = kcContext.realm;
@let social = kcContext.social;
@let usernameHidden = kcContext.usernameHidden;
@let messagesPerField = kcContext.messagesPerField;
@let url = kcContext.url;
@let login = kcContext.login;

<kc-login-template
  [displayInfo]="displayInfo"
  [bodyClassName]="bodyClassName()"
  [displayMessage]="displayMessage"
  [displayRequiredFields]="displayRequiredFields()"
  [documentTitle]="documentTitle()"
>
  <ng-container headerNode>
    {{ 'doLogin' | translate }}
  </ng-container>
  <ng-container infoNode>
    <div id="kc-registration">
      <span>
        {{ 'noAccount' | translate }}
        <a
          tabindex="6"
          [href]="url?.registrationUrl"
        >
          {{ 'doRegister' | translate }}
        </a>
      </span>
    </div>
  </ng-container>
  <ng-container socialProvidersNode>
    @if (!!realm?.password && !!social?.providers?.length) {
      <div
        id="kc-social-providers"
        [kcClass]="'kcFormSocialAccountSectionClass'"
      >
        <hr />
        <h2>{{ 'identity-provider-login-label' | translate }}</h2>
        <ul
          [kcClass]="{
            kcFormSocialAccountListClass: true,
            kcFormSocialAccountListGridClass: (social?.providers?.length ?? 0) > 3,
          }"
        >
          @for (provider of social?.providers; track provider.alias; let idx = $index) {
            <li>
              <a
                [id]="provider.alias"
                [kcClass]="{
                  kcFormSocialAccountListButtonClass: true,
                  kcFormSocialAccountGridItem: (social?.providers?.length ?? 0) > 3,
                }"
                type="button"
                [href]="provider.loginUrl"
              >
                @if (provider.iconClasses) {
                  <i
                    [ngClass]="provider.iconClasses"
                    [kcClass]="'kcCommonLogoIdP'"
                    aria-hidden="true"
                  ></i>
                }
                <span
                  [ngClass]="{
                    'kc-social-icon-text': provider.iconClasses,
                  }"
                  [kcClass]="'kcFormSocialAccountNameClass'"
                  [innerHTML]="provider.displayName | safe: 'html'"
                ></span>
              </a>
            </li>
          }
        </ul>
      </div>
    }
  </ng-container>
  <ng-container content>
    <div id="kc-form">
      <div id="kc-form-wrapper">
        @if (realm.password) {
          <form
            id="kc-form-login"
            (onSubmit)="isLoginButtonDisabled.set(true)"
            [action]="url?.loginAction"
            method="post"
          >
            @if (!usernameHidden) {
              <div [kcClass]="'kcFormGroupClass'">
                <label
                  for="username"
                  [kcClass]="'kcLabelClass'"
                >
                  @if (!realm?.loginWithEmailAllowed) {
                    {{ 'username' | translate }}
                  } @else if (!realm?.registrationEmailAsUsername) {
                    {{ 'usernameOrEmail' | translate }}
                  } @else {
                    {{ 'email' | translate }}
                  }
                </label>
                <input
                  tabindex="2"
                  id="username"
                  [kcClass]="'kcInputClass'"
                  name="username"
                  type="text"
                  autofocus
                  autoComplete="off"
                  [defaultValue]="login?.username || ''"
                  [attr.aria-invalid]="messagesPerField?.existsError('username')"
                />
                @if (messagesPerField?.existsError('username')) {
                  <span
                    id="input-error"
                    [kcClass]="'kcInputErrorMessageClass'"
                    aria-live="polite"
                    [innerHTML]="messagesPerField?.getFirstError('username') | safe: 'html'"
                  >
                  </span>
                }
                <!---->
              </div>
            }

            <div [kcClass]="['kcFormGroupClass', 'kcFormSettingClass']">
              <div id="kc-form-options">
                @if (realm.rememberMe && !usernameHidden) {
                  <div class="checkbox">
                    <label>
                      <input
                        tabindex="5"
                        id="rememberMe"
                        name="rememberMe"
                        type="checkbox"
                        [defaultChecked]="!!login?.rememberMe"
                      />
                      {{ 'rememberMe' | translate }}
                    </label>
                  </div>
                }
              </div>
            </div>
            <div
              id="kc-form-buttons"
              [kcClass]="'kcFormGroupClass'"
            >
              <input
                tabindex="4"
                [kcClass]="['kcButtonClass', 'kcButtonPrimaryClass', 'kcButtonBlockClass', 'kcButtonLargeClass']"
                name="login"
                id="kc-login"
                type="submit"
                [value]="'doLogIn' | translate"
              />
            </div>
          </form>
        }
      </div>
    </div>
  </ng-container>
</kc-login-template>
